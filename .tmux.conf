#!/bin/bash
# for vim : open man and see what each command means in this file
# nnoremap <leader>k :!man -P 'less -p <C-R><C-A>' tmux<CR>
# start window indexing at one instead of zero
set -g base-index 1
set -g pane-base-index 1
# enable 256 colors
set -g default-terminal "screen-256color"
# set this otherwise the text will become garbled # not needed from tmux 2.2  TODO remove
set -gq utf8 on
set -gq status-utf8 on
# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0
set -g history-limit 99999
set -g mouse on
set -g renumber-windows on
# dont detach when other sessions are active [ for scratch ]
set -g detach-on-destroy off
set -g default-shell /bin/zsh
# ############################################################ APPEARANCE RELATED
set -g message-style "fg=white,bg=red,bright"
set -g status-left " #S "
set -g status-left-length 12
set -g status-right-length 15
set -g status-left-style "fg=white,bg=colour236"
set -g status-right-length 65
set -g status-style "bg=colour233,fg=colour241"
set -g window-status-current-format " #I:#W#{?window_zoomed_flag,Z,} "
set -g window-status-current-style "fg=colour13,bg=colour8"
set -g window-status-format " #I:#W#{?window_zoomed_flag,Z,} "
set -g set-titles on
# #h hostshort , #S session , #W window , #T pane name
set -g set-titles-string '#h: [#S-#W-#T] '
set -g status-right "\
#{?client_prefix,<Prefix>,} \
#{=22:pane_title} \
#[fg=colour28]#(echo $USER)\
"
# The panes {

set -g pane-border-style fg=colour8
set -g pane-active-border-style fg=magenta
# toggle pane labels
bind C-t run-shell 'tmux set -g pane-border-status'
# set -g pane-border-status top
# set -g pane-border-format "#{?pane_active,#[fg=#aaaaaa],#[fg=#707070]}%#P

# }

#################################################################### key Bindings with PREFIX
# C-b is not acceptable as prefix -- Vim uses it
unbind C-b
set -g prefix  C-a
set -g prefix2 C-a
bind C-a send-prefix
bind `   send-prefix -2

# use vim key bindings
setw -g mode-keys vi
bind -t vi-copy 'v'     begin-selection
bind -t vi-copy 'C-v'   rectangle-toggle

# toggle status line visibility
bind S   set-option -g status
# move x clipboard into tmux paste buffer and paste (X -> tmux )
bind C-v run "tmux set-buffer \"$(xclip -o -selection clipboard)\"; tmux paste-buffer"
# or use Shift+Middle-click to select and Shift+Middle-click to paste
bind    r source-file ~/.tmux.conf \; display "Reloaded tmux config file."
bind    Bspace "kill-session"
# Easy bindings for split
bind    \ split-window -h -c "#{pane_current_path}"
bind    - split-window -v -c "#{pane_current_path}"
# }}}

# bind with no prefix commnds {{{
# hjkl pane resize
bind -n M-h resize-pane -L 2
bind -n M-j resize-pane -D 2
bind -n M-k resize-pane -U 2
bind -n M-l resize-pane -R 2
bind -n F12 set-window-option synchronize-panes \; display "sync toggle"
# Smart pane switching with awareness of vim splits
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
# switch windows alt+number
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-` switch-client -n
# complensate for the lost keys to send actual 'key' do prefix + 'key'
# bind C-k send-keys 'C-k'    # for vim digraph
# bind C-l send-keys 'C-l'    # for ncmpcpp lock screen
bind M-1 send-keys 'M-1'
bind M-2 send-keys 'M-2'
bind M-3 send-keys 'M-3'
bind M-4 send-keys 'M-4'
bind M-5 send-keys 'M-5'
bind M-6 send-keys 'M-6'
bind M-7 send-keys 'M-7'
bind M-8 send-keys 'M-8'
bind M-9 send-keys 'M-9'
# }}}

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'
run '~/.tmux/plugins/tpm/tpm'
