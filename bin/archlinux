#!/bin/bash

# commands to get an arch linux up and running.
# followiing the video of sean Bruen : Arch Linux : from post install to Xorg
: enable EFI boot in virtual box settings.
# rank mirrors
sudo cp /etc/pacman.d/mirrorlist  /etc/pacman.d/mirrorlist.bkp
sed -i 's/^#Server/Server/' /etc/pacman.d/mirrorlist.bkp
rankmirrors -n 6 /etc/pacman.d/mirrorlist.bkp > /etc/pacman.d/mirrorlist

loadkeys us
timedatectl set-ntp true
fdisk /dev/sda # check 'm' for 'n' , 't',  and set EFI
make gpt table # UEFI needs that
# sda1   512MB   EFI_system(ef00)        /boot
# sda2   16G     LINUX_swap        SWAP
# sda3   100G    Linux_filesystem  /
# sda4   rem     Linux_filesystem  /home
# use systemd-boot
root=/dev/sda3
mkfs.fat -F32 /dev/sda1 #EFI
mkfs.ext4 /dev/sda1
mount $root /mnt
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
# wifi-menu
pacstrap /mnt base
genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt
passwd
# setup bootloader
# systemd-boot
bootctl --path=/boot install
# make conf file https://wiki.archlinux.org/index.php/Systemd-boot#Configuration
cat <<EOF > /boot/loader/loader.conf
default  arch
timeout  4
editor   0
EOF
blkid -s PARTUUID -o value $root >> /boot/loader/enrtries/arch.conf
cat <<EOF > /boot/loader/entries/arch.conf
title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options root=PARTUUID=asdfsadf-asdf-asdf rw
EOF
# change default boot to HARD DISK
#systemctl reboot # REBOOT =================================================================
hostnamectl set-hostname rivnedell #echo "rivendell" > /etc/hostname
timedatectl set-timezone Asia/Kolkata
# uncomment /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf  # VVI else special characters wont be reco in vim and tmux
echo "KEYMAP=us" > /etc/vconsole.conf
# enable network through netctl
cp /etc/netctl/example/ethernet-dhcp /etc/netctl/ethernet
# edit ethernet link name
netctl start ethernet
netctl enable ethernet
# see if net is accessible
# USER CREATION
useradd -m -g users -s /bin/bash murali
passwd murali
echo " see edit from 2:00 - 2:20 "
pacman -Syu
ln -s /usr/share/zoneinfo/Reginon/City /etc/localtime
hwclock --systohc

pacman -S sudo # virtualbox-guest-modules-arch virtualbox-guest-utils
echo "visudo /etc/sudoers"
echo "dulpicate root ..murali ALL"
sudo sed 's/^#TotalD/TotalD/' -i /etc/pacman.conf
# to make pacman and yaourt work behind proxy
sudo sh -c 'echo Defaults env_keep += \"http_proxy https_proxy ftp_proxy\" >> /etc/sudoers'
pacman -Syu
# INSTALL BASIC STUFF TMUX VIM ZSH etc
sudo pacman -S fakeroot git jshon wget make pkg-config \
  autoconf automake patch expac zsh tmux python gvim ttf-freefont binutils \
# INSTALL BASIC XSERVER WITH AWESOME
sudo pacman -S alsa-utils xorg-server xorg-xinit xorg-apps mesa awesome \
  xf86-video-vesa xterm rxvt-unicode xsel xclip --noconfirm
modprobe -a vboxguest vboxsf vboxvideo # or
cat <<EOF > /usr/lib/modules-load.d/virtualbox.conf
vboxguest
vboxsf
vboxvideo
EOF
systemctl enable vboxservice.service
lspci | grep VGA # to see the graphics driver
pacman -Ss xf86-video | less # and install the direver of g-card

# startx should work now

wget http://aur.archlinux.org/cgit/aur.git/snapshot/packer.tar.gz
tar zxvf packer.tar.gz
cd packer && makepkg
sudo pacman -U ~/packer/packer-20*.pkg.tar.xz --noconfirm
packer -S yaourt --noconfirm
git clone 'https://github.com/muralisc/dotfiles'
~/dotfiles/install.sh
# enable auto-login
sudo systemctl edit getty@tty1
sudo mkdir -p /etc/systemd/system/getty@tty1.service.d
sudo sh -c 'cat << EOF >> /etc/systemd/system/getty@tty1.service.d/override.conf
[Service]
ExecStart=
ExecStart=-/usr/bin/agetty --autologin vagrant --noclear %I $TERM
EOF
'


yaourt -S vicious light-git urxvt-perls urxvt-resize-font-git urxvt-vtwheel --noconfirm
git clone https://github.com/terceiro/awesome-freedesktop
sudo mv awesome-freedesktop/freedesktop /etc/xdg/awesome/
rm -rf awesome-freedesktop
echo "skip from 9:20 to 10:50 "
echo "skip from 11:00 to 14.38 "
systemctl reboot


# check startx working
echo "  ===========add inifinality============     "
# GUI TERMINAL URXVT SHOULD BE WORKING BY NOW
sudo pacman -S jre8-openjdk firefox yajl
yaourt -S mt7601u-git   # for external wifi dongle
echo "kernel.sysrq=1" >> /etc/sysctl.d/99-sysctl.conf
# zathura for backup // use browser instead; firefox even shows
# comments,
aurvote
zathura-ps `# inline comment this way`
ncdc    #linux commandline dcpp client
# RANGER STUFF
yaourt -S   ranger w3m ffmpeg ffmpegthumbnailer imagemagick mediainfo --noconfirm
# AUDIO and movies STUFF
alsa-utils
submarine subliminal # subtitle stuff
bluez bluez-utils
pavucontrol pacmixer pulsemixer pulseaudio pulseaudio-alsa pulseaudio-bluetooth
mpd mpc ncmpcpp mpv


yaourt -S --noconfirm                                                               \
  ntfs-3g perl-rename jmtpfs sed rsync tar gzip feh gawk gcc gdb gnuplot grep groff \
  tig `#helps a lot`                                                                \
  tk `#for wish ( gitk )`                                                           \
  bbswitch                                                                          \
  bumblebee                                                                         \
  dropbox                                                                           \
  faenza-icon-theme                                                                 \
  atool htop i3lock                                                                 \
  inkscape                                                                          \
  iw                                                                                \
  leafpad                                                                           \
  lib32-mesa-libgl                                                                  \
  lib32-nvidia-utils                                                                \
  libreoffice-still                                                                 \
  lxappearance nvidia                                                               \
  openssh                                                                           \
  package-quer                                                                      \
  puddletag                                                                         \
  rofi-git                                                                          \
  thunderbird                                                                       \
  tigervnc                                                                          \
  xf86-input-synaptics                                                              \
  xf86-video-intel                                                                  \
  xorg-xinit                                                                        \
  youtube-dl                                                                        \
  zukwito-themes                                                                    \
  unzip                                                                             \
  xorg-xprop                                                                        \
  xorg-xev                                                                          \
  compton-git                                                                       \
  cronie                                                                            \
  keynav-git                                                                        \
  logkeys-git                                                                       \
  xorg-xev                                                                          \
  xorg-xwininfo                                                                     \
  sshfs                                                                             \
  kdebase-runtime ( for kdenlive)                                                   \
  vnstat                                                                            \
  espeak                                                                            \
  xvkbd                                                                             \
  xzoom                                                                             \
  reflector                                                                         \
  mpdcron `#https://aur.archlinux.org/packages/mpdcron-git/` \
  ttf-dejavu `# needed for bold`
