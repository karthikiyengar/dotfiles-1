#!/bin/bash

# command to get an arch linux up and running TODO

# followiing the video of sean Bruen : Arch Linux : from post install to Xorg

###############
# Virtual Box #
###############

# for vagrant box with diff key layout sudo loadkeys us
# install virtualbox-guest-utils if in virtual box

# updated 12-7-2016
loadkeys us
timedatectl set-ntp true
fdisk /dev/sda
    make gpt table # UEFI needs that
           sda1   512MB   EFI_system(ef00)        /boot
           sda2   16G     LINUX_swap        SWAP
           sda3   100G    Linux_filesystem  /
           sda4   rem     Linux_filesystem  /home
    # use systemd-boot
mkfs.fat -F32 /dev/sda1 #EFI
mkfs.ext4 /dev/sda1
mount /dev/sda3 /mnt
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
pacstrap /mnt base

genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt
ln -s /usr/share/zoneinfo/Reginon/City /etc/localtime
hwclock --systohc
# uncomment /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf
echo "KEYMAP=us" > /etc/vconsole.conf
echo "rivendell" > /etc/hostname
pacman -S networkmanager
systemctl enable NetworkManager.service
timedatectl set-timezone Asia/Kolkatta
passwd
# setup bootloader
    # systemd-boot
    bootctl --path=/boot install
    # make conf file https://wiki.archlinux.org/index.php/Systemd-boot#Configuration


# USER CREATION
useradd -m -g users -s /bin/bash murali
#passwd murali
echo " see edit from 2:00 - 2:20 "
pacman -Syu
echo " reboot if necessary "
pacman -S sudo
echo "visudo /etc/sudoers"
echo "dulpicate root ..murali ALL"

sudo sed 's/^#TotalD/TotalD/' -i /etc/pacman.conf
# to make pacman and yaourt work behind proxy
sudo sh -c 'echo Defaults env_keep += "http_proxy https_proxy ftp_proxy" >> /etc/sudoers'
pacman -Syu
# INSTALL BASIC STUFF TMUX VIM ZSH etc
sudo pacman -S fakeroot git jshon wget make pkg-config autoconf automake patch expac zsh tmux gvim
wget http://aur.archlinux.org/cgit/aur.git/snapshot/packer.tar.gz
tar zxvf packer.tar.gz
cd packer && makepkg
sudo pacman -U ~/packer/packer-20150808-1-any.pkg.tar.xz
packer -S yaourt
~/dotfiles/install.sh



# INSTALL BASIC XSERVER WITH AWESOME

# enable auto-login
sudo sh -c 'cat << EOF >> /etc/systemd/system/getty@tty1.service.d/override.conf
[Service]
ExecStart=
ExecStart=-/usr/bin/agetty --autologin vagrant --noclear %I $TERM
EOF
'


sudo pacman -S alsa-utils xorg-server xorg-xinit xorg-server-utils mesa awesome \
xf86-video-vesa xterm rxvt-unicode xsel xclip --noconfirm
sudo yaourt -S vicious light-git urxvt-perls urxvt-resize-font-git urxvt-vtwheel --noconfirm
git clone https://github.com/terceiro/awesome-freedesktop
sudo mv awesome-freedesktop/freedesktop /etc/xdg/awesome/
rm -rf awesome-freedesktop
echo "skip from 9:20 to 10:50 "
echo "skip from 11:00 to 14.38 "
reboot
# check startx working
echo "  ===========add inifinality============     "
# ADD infinaliyt repo
sudo sh -c 'cat << END >> /etc/pacman.conf
[infinality-bundle]
Server = http://bohoomil.com/repo/\$arch

[infinality-bundle-multilib]
Server = http://bohoomil.com/repo/multilib/\$arch

[infinality-bundle-fonts]
Server = http://bohoomil.com/repo/fonts
END'
sudo pacman-key -r 962DDE58
sudo pacman-key --lsign-key 962DDE58
sudo pacman -S infinality-bundle
sudo pacman -S ttf-ubuntu-font-family-ib
# GUI TERMINAL URXVT SHOULD BE WORKING BY NOW


# INSTALL AND SETUP ZSH {{{
bash ./zshsetup
# }}}



sudo pacman -S jre8-openjdk firefox yajl
yaourt -S mt7601u-git   # for external wifi dongle
echo "kernel.sysrq=1" >> /etc/sysctl.d/99-sysctl.conf
# zathura for backup // use browser instead; firefox even shows
# comments,
aurvote
zathura-ps
ncdc    #linux commandline dcpp client

# RANGER STUFF
yaourt -S   ranger w3m ffmpeg ffmpegthumbnailer imagemagick mediainfo --noconfirm

# AUDIO and movies STUFF
alsa-utils
submarine subliminal # subtitle stuff
bluez bluez-utils
pavucontrol pacmixer pulsemixer pulseaudio pulseaudio-alsa pulseaudio-bluetooth
mpd mpc ncmpcpp mpv


# DISK stuff and misc must install
yaourt -S --noconfirm ntfs-3g perl-rename jmtpfs sed rsync tar gzip feh gawk gcc gdb gnuplot grep groff

#  APPS WITHOUT  GUI
#  APPS WITH  GUI

bbswitch
bumblebee
dropbox
faenza-icon-theme
atool htop i3lock
inkscape
iw
leafpad
lib32-mesa-libgl
lib32-nvidia-utils
libreoffice-still
lxappearance nvidia
openssh
package-quer
puddletag
rofi-git
thunderbird
tigervnc
xf86-input-synaptics
xf86-video-intel
xorg-xinit
yaourt
youtube-dl
zukwito-themes
unzip
xorg-xprop
xorg-xev
compton-git
cronie
keynav-git
logkeys-git
xorg-xev
xorg-xwininfo
sshfs
kdebase-runtime ( for kdenlive)
vnstat



# order mirrorlist
sudo cp /etc/pacman.d/mirrorlist  /etc/pacman.d/mirrorlist.bkp
sed -i 's/^#Server/Server/' /etc/pacman.d/mirrorlist.bkp
rankmirrors -n 6 /etc/pacman.d/mirrorlist.bkp > /etc/pacman.d/mirrorlist

